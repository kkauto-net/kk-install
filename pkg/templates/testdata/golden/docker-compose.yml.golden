version: '3.8'\nservices:\n  kkengine:\n    image: kkengine:latest\n    container_name: kkengine_app\n    restart: unless-stopped\n    stop_grace_period: 10s\n    ports:\n      - "8019:8019"\n    env_file:\n      - ./.env\n    volumes:\n      - ./kkphp.conf:/config/kkphp.conf\n    networks:\n      - kkengine_net\n    depends_on:\n      db:\n        condition: service_healthy\n      redis:\n        condition: service_started\n\n  db:\n    image: mariadb:10.6\n    container_name: kkengine_db\n    restart: unless-stopped\n    environment:\n      MYSQL_ROOT_PASSWORD: test_db_root_pass\n      MYSQL_DATABASE: kkengine\n      MYSQL_USER: kkengine\n      MYSQL_PASSWORD: test_db_pass\n    volumes:\n      - ./data_database:/var/lib/mysql\n    ports:\n      - "3307:3306"\n    networks:\n      - kkengine_net\n    healthcheck:\n      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 30s\n\n  redis:\n    image: redis:alpine\n    container_name: kkengine_redis\n    restart: unless-stopped\n    command: redis-server --requirepass test_redis_pass\n    volumes:\n      - redis_data:/data\n    networks:\n      - kkengine_net\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n\nnetworks:\n  kkengine_net:\n    name: kkengine_net\n    driver: bridge\n\nvolumes:\n  redis_data:
